<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Колесо Фортуны</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Roboto Slab', serif;
            /* الخلفية */
            background-image: url('Айнора.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-color: #f0f0f0; 
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* حاوية العجلة */
        .wheel-container {
            position: relative;
            width: 280px; 
            height: 280px;
            margin: 0 auto;
            border-radius: 50%;
            background-color: #ffffff; 
            padding: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            border: 4px solid #FFD700; 
        }

        @media (min-width: 640px) {
            .wheel-container {
                width: 380px;
                height: 380px;
                padding: 10px;
            }
        }

        /* القماش (Canvas) */
        #wheelCanvas {
            display: block;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            transition: transform 6s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        /* زر التدوير */
        .spin-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70px;
            height: 70px;
            background: radial-gradient(circle at 30% 30%, #ff6b6b, #d32f2f);
            border: 3px solid #fff;
            border-radius: 50%;
            color: white;
            font-weight: bold;
            font-size: 10px;
            cursor: pointer;
            z-index: 20;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .spin-btn:active {
            transform: translate(-50%, -50%) scale(0.95);
        }
        
        .spin-btn:disabled {
            cursor: not-allowed;
            filter: grayscale(0.5);
        }

        /* المؤشر */
        .pointer {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 40px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2300BFFF' stroke='%23fff' stroke-width='2' stroke-linejoin='round'%3E%3Cpath d='M12 22l-10-14h20z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-size: contain;
            z-index: 10;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
        }

        /* الأضواء */
        .light {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #ddd;
            top: 50%;
            left: 50%;
            z-index: 5;
        }

        .light.on {
            background-color: #FFD700;
            box-shadow: 0 0 8px #FFD700;
        }

        /* نافذة النتيجة */
        .result-box {
            opacity: 0;
            transform: translateY(15px);
            transition: all 0.5s ease;
            pointer-events: none; 
        }
        .result-box.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

    </style>
</head>
<body class="py-4">

    <!-- العنوان -->
    <h1 class="text-xl md:text-2xl mb-6 font-bold text-white drop-shadow-md bg-black/40 px-6 py-2 rounded-full border border-white/20">
        КОЛЕСО ФОРТУНЫ
    </h1>

    <!-- قسم العجلة -->
    <div class="wheel-container" id="wheelContainer">
        <canvas id="wheelCanvas" width="400" height="400"></canvas>
        <div class="pointer"></div>
        <button class="spin-btn" id="spinBtn" onclick="spinWheel()">КРУТИТЬ</button>
    </div>

    <!-- قسم النتيجة -->
    <div id="resultBox" class="result-box mt-6 text-center p-4 bg-white/95 text-gray-800 rounded-lg shadow-xl border-2 border-yellow-400 max-w-[200px]">
        <h2 class="text-lg font-bold text-green-600 mb-1">Поздравляем!</h2>
        <div class="text-sm text-gray-600">Результат:</div>
        <div id="winnerValue" class="text-3xl font-black mt-1 text-blue-600"></div>
    </div>

    <script>
        // البيانات
        const segments = ["34", "36", "36,5", "37", "38", "39", "41", "42", "43", "45"];
        
        // الألوان
        const colors = [
            '#FF9AA2', '#FFB7B2', '#FFDAC1', '#E2F0CB', '#B5EAD7', 
            '#C7CEEA', '#90E0EF', '#FFD700', '#FFA07A', '#D8BFD8'
        ];
        
        // المتغيرات
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const spinBtn = document.getElementById('spinBtn');
        const resultBox = document.getElementById('resultBox');
        const winnerValueDisplay = document.getElementById('winnerValue');
        const wheelContainer = document.getElementById('wheelContainer');
        
        const size = 400; 
        const centerX = size / 2;
        const centerY = size / 2;
        const radius = size / 2;
        const arc = (2 * Math.PI) / segments.length;

        let currentRotation = 0;
        let isSpinning = false;
        let lightInterval;

        // رسم العجلة
        function drawWheel() {
            ctx.clearRect(0, 0, size, size);

            for (let i = 0; i < segments.length; i++) {
                const angle = i * arc;
                
                ctx.beginPath();
                ctx.fillStyle = colors[i];
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, angle, angle + arc);
                ctx.lineTo(centerX, centerY);
                ctx.fill();
                
                ctx.strokeStyle = "#fff"; 
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(angle + arc / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "#333"; 
                ctx.font = "bold 36px 'Roboto Slab'";
                
                ctx.fillText(segments[i], radius - 20, 12);
                ctx.restore();
            }
        }

        drawWheel();

        // إنشاء الأضواء
        function createLights() {
            const numLights = 16;
            for(let i=0; i<numLights; i++) {
                const light = document.createElement('div');
                light.className = 'light';
                const angle = (i / numLights) * 2 * Math.PI;
                const containerW = wheelContainer.clientWidth;
                const r = (containerW / 2) - 5; 
                const x = Math.cos(angle) * r;
                const y = Math.sin(angle) * r;
                light.style.transform = `translate(${x}px, ${y}px)`;
                wheelContainer.appendChild(light);
            }
        }
        
        window.addEventListener('load', createLights);
        window.addEventListener('resize', () => {
            document.querySelectorAll('.light').forEach(l => l.remove());
            createLights();
        });

        // حركة الأضواء
        function startLightAnimation() {
            const lights = document.querySelectorAll('.light');
            let activeIndex = 0;
            clearInterval(lightInterval);
            lightInterval = setInterval(() => {
                lights.forEach(l => l.classList.remove('on'));
                lights[activeIndex % lights.length].classList.add('on');
                lights[(activeIndex + lights.length/2) % lights.length].classList.add('on');
                activeIndex++;
            }, 100);
        }

        function stopLightAnimation() {
            clearInterval(lightInterval);
            const lights = document.querySelectorAll('.light');
            lights.forEach((l, i) => {
                l.classList.remove('on');
                if (i % 2 === 0) l.classList.add('on');
            });
        }

        // التدوير (تم التعديل لضمان الوقوف في المنتصف)
        function spinWheel() {
            if (isSpinning) return;

            isSpinning = true;
            resultBox.classList.remove('show');
            spinBtn.disabled = true;

            startLightAnimation();

            // 1. حساب زاوية القسم الواحد (36 درجة في حالتك)
            const segmentAngle = 360 / segments.length;
            
            // 2. اختيار القسم الفائز عشوائياً (بدلاً من درجة عشوائية)
            const randomSegmentIndex = Math.floor(Math.random() * segments.length);
            
            // 3. حساب زاوية مركز القسم الفائز
            // (رقم القسم * عرض القسم) + نصف عرض القسم
            const targetCenter = (randomSegmentIndex * segmentAngle) + (segmentAngle / 2);

            // 4. حساب مكان المؤشر الحالي بالنسبة لزوايا العجلة
            // هذه المعادلة مستخدمة لمعرفة "أين نحن الآن" قبل الدوران
            const currentPosition = (270 + currentRotation) % 360;

            // 5. حساب المسافة الدقيقة التي يجب أن نقطعها ليصل "مركز الهدف" تحت المؤشر
            let distance = targetCenter - currentPosition;
            
            // التأكد من أن المسافة موجبة ليدور للأمام
            if (distance < 0) {
                distance += 360;
            }

            // 6. إضافة عدد لفات كاملة (لإعطاء تأثير الدوران)
            const minSpins = 5; 
            const maxSpins = 8;
            const fullSpins = (Math.floor(Math.random() * (maxSpins - minSpins + 1)) + minSpins) * 360;
            
            // الزاوية النهائية للدوران
            const spinAngle = fullSpins + distance;

            currentRotation += spinAngle;

            canvas.style.transform = `rotate(-${currentRotation}deg)`;

            setTimeout(() => {
                calculateWinner(currentRotation);
                stopLightAnimation();
                isSpinning = false;
                spinBtn.disabled = false;
            }, 6000);
        }

        // حساب الفائز
        function calculateWinner(rotation) {
            const actualRotation = rotation % 360;
            const segmentAngle = 360 / segments.length;
            const degreesAtPointer = (270 + actualRotation) % 360;
            let index = Math.floor(degreesAtPointer / segmentAngle);
            if (index >= segments.length) index = 0;
            winnerValueDisplay.textContent = segments[index];
            resultBox.classList.add('show');
        }

    </script>
</body>
</html>

